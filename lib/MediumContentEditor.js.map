{"version":3,"sources":["MediumContentEditor.es6"],"names":[],"mappings":"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","file":"MediumContentEditor.js","sourcesContent":["// Imports\nimport {\n    Component,\n    Directive,\n    Input,\n    Output,\n    ElementRef,\n    ViewChild,\n    Optional,\n    OptionalMetadata,\n    EventEmitter\n} from 'angular2/core';\nimport {NgControl, ControlValueAccessor} from 'angular2/common';\n\n/**\n * CKEditor component\n * Usage :\n * <textarea [(ngModel)]=\"data\" [config]=\"{...}\" configFile=\"file.js\"></textarea>\n */\n@Component({\n    selector: 'meditor.editable',\n    template: `<textarea #host></textarea>\n    <button (click)=\"hackUpdate($event)\" #button></button>`\n})\n@Reflect.metadata('parameters', [null, [new OptionalMetadata()]])\nexport class MediumContentEditor {\n\n    @Input() config;\n    @Input() configFile;\n\n    @Output() change = new EventEmitter();\n    @ViewChild('host') host;\n    @ViewChild('button') button;\n\n    value = '';\n    instance = null;\n    ngControl;\n\telementRef;\n\n    // Hack button\n    _buttonEl;\n\n    /**\n     * Constructor\n     */\n    constructor(elementRef:ElementRef, ngControl:NgControl){\n        if( ngControl ){\n            ngControl.valueAccessor = this;\n            this.ngControl = ngControl;\n        }\n\tthis.elementRef = elementRef;\n    }\n\n    /**\n     * On component destroy\n     */\n    ngOnDestroy(){\n        if( this.editor ) {\n            this.instance.removeAllListeners();\n            this.editor.destroy();\n            this.editor = null;\n        }\n    }\n\n    /**\n     * On component view init\n     */\n    ngAfterViewInit(){\n        // Configuration\n        var config = {};\n\n        // Fetch file\n        if( this.configFile ){\n\n            if( System && System.import ){\n                System.import(this.configFile)\n                    .then((res) => {\n                        this.editorInit( res.config );\n                    })\n            }\n\n        // Config object\n        }else{\n            config = this.config || {};\n            this.editorInit( config );\n        }\n    }\n\n    /**\n     * Editor init\n     */\n    editorInit( config ){\n\n\tthis.editor = new MediumEditor(this.host._appElement.nativeElement, config);\n\n        // Hide hack button\n        this._buttonEl = this.button._appElement.nativeElement;\n        this._buttonEl.style.display = 'none';\n\n\t        // Change event\n\tlet editable =  this.editor.elements[0];\n            this.editor.subscribe('editableInput',  (event, editable)=> {\n                          let value =this.editor.elements[0].innerHTML;\n\n\t\t\t    // This doesn't work ???\n\t\t\t    this.onChange( value );\n\t\t\t    this.change.emit( value );\n\t\t\t    this.ngControl.viewToModelUpdate(value);\n\n\t\t\t    // Hack\n\t\t\t    //this._buttonEl.dispatchEvent(new Event('click'))\n            });\n\n\n    }\n\n    /**\n     * Hack to update model\n     */\n    hackUpdate(){\n        if( this.editor ){\n            var value = this.vlaue;\n            this.ngControl.viewToModelUpdate(value);\n            //this.onChange( value );\n            this.change.emit( value );\n        }\n    }\n\n    /**\n     * Implements ControlValueAccessor\n     */\n    writeValue(value){\n        this.value = value;\n\t\n        if( this.editor ){\n\t\tthis.editor.elements[0].nextSibling.value=value;\n           \tthis.editor.elements[0].innerHTML=(value);\n\t\tthis.editor.elements[0].setAttribute(\"data-placeholder\",\"\");\n\t}\n    }\n    onChange(_){}\n    onTouched(){}\n    registerOnChange(fn){this.onChange = fn;}\n    registerOnTouched(fn){this.onTouched = fn;}\n}\n"],"sourceRoot":"/source/"}